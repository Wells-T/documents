## 操作场景
目前云原生网关Kong支持注册中心（包括 Nacos、Consul 和 PolarisMesh）与容器服务（包括 TKE，EKS 和 TEM）两类服务来源，您可以将部署了后端服务的容器集群或注册有后端服务的注册中心添加到网关服务来源中，以便网关能获取服务列表，查找对应的服务地址从而实现动态代理。

## 前置条件
已购买 Kong 网关实例，[操作文档](https://cloud.tencent.com/document/product/1364/72495)。

## 操作步骤
### 添加服务来源
1. 登陆登录 微服务引擎控制台 ，在左侧导航栏单击云原生网关 > Kong，点击目标Kong网关实例，进入实例详情页。
2. 在顶部菜单栏选择 服务管理，在服务来源 点击 新建。
3. 在新建服务来源窗口中配置相关参数。
|参数|是否必填|说明|
|来源类型	|是|服务来源类型，支持注册中心和容器服务两类来源。|

当服务来源为注册中心时，填写以下参数：
|参数	|是否必填	|说明|
|来源产品	|是	|来源产品，支持TSE注册中心和自建注册中心，注册中心类型包括 Nacos，Consul 和 PolarisMesh。说明：使用Kong对接TSE注册中心将提供更加流畅的使用体验，推荐使用TSE注册中心。|
|选择实例	|是	|当来源产品为TSE注册中心时，选择后端服务所在的注册中心实例。|
|来源名称	|是	|当来源产品为自建注册中心时，填写来源名称。|
|访问地址	|是	|当来源产品为自建注册中心时，填写访问地址，多个访问地址使用换行分隔。
针对不同注册中心，访问地址书写方式为：
● 自建Nacos：填写域名或IP:Port
● 自建Consul：填写域名或IP:Port
● 自建PolarisMesh：填写http和grpc访问地址作为一组访问地址，每组格式为：
http://IP:{HTTP_PORT}
grpc://IP:{GRPC_PORT}|
|用户名	|否	|对于类型为Nacos的注册中心，如开启了注册中心鉴权功能，填写访问用户名。|
|密码	|否	|对于类型为Nacos的注册中心，如开启了注册中心鉴权功能，填写访问密码。|
|Token	|否	|对于类型为Consul和PolarisMesh的注册中心，如开启了注册中心鉴权功能，填写访问Token。|
当服务来源为容器服务时，填写以下参数：
|参数	|是否必填	|说明|
|来源产品	|是	|来源产品，支持TKE容器服务、EKS弹性容器服务和TEM应用。|
|选择实例	|是	|选择后端服务所在的容器集群。|
4. 添加后， 查看服务来源列表，包含新建的服务来源信息，则说明服务来源创建成功。
<img src="https://qcloudimg.tencent-cloud.cn/raw/3889a93ce61f38d736c7c3b5c4bcbc8c.png">

### 删除服务来源
点击操作 > 删除，确认是否删除服务来源。确认后将删除服务来源。
>! 注意：如果当前服务来源已有服务关联，则不允许删除，需删除服务后重试。

### 添加服务
1. 在顶部菜单栏选择 服务管理，在服务列表 点击 新建。
2. 在新建服务窗口中配置相关参数。
|参数	|是否必填	|说明|
|来源类型	|是	|服务来源类型，支持注册中心和容器服务两类来源。|
当服务来源为注册中心时，填写以下参数：
|参数	|是否必填	|说明|
|来源产品	|是	|来源产品，支持 Nacos，Consul 和 PolarisMesh。|
|服务来源	|是	|选择已创建的服务来源。|
|命名空间	|是	|当来源产品为Nacos/PolarisMesh时，输入命名空间ID。
**注意：Nacos默认命名空间请填写empty_ns。**|
|服务列表	|是	|填写需要访问的服务列表，多个服务使用换行分隔。
针对不同注册中心，服务列表书写方式为：
- Nacos：{Nacos分组}__{服务名称}

注意：Nacos分组与服务名称之间使用两个下划线(_)分割
- Consul：{服务名称}
- PolarisMesh：{服务名称}|
当服务来源为容器服务时，填写以下参数：
|参数	|是否必填	|说明|
|来源产品	|是	|来源产品，支持TKE、EKS和TEM。|
|服务来源	|是	|选择已创建的服务来源。|
|命名空间	|是	|输入命名空间名称。|
|服务列表	|是	|填写需要访问的容器服务列表，多个服务使用换行分隔。|
3. 添加后， 查看服务列表，包含新建的服务信息，则说明服务创建成功。

### 验证服务转发
1. 进入Kong实例页面，在顶部菜单栏点击 访问控制，查看Konga控制台访问地址，使用账号和密码登陆 Konga。
2. 点击左侧导航栏 SERVICES，查看服务列表。对于每个添加的注册中心/容器服务，都会对应生成一个服务（Service），以用于路由转发。
>! 注意：默认命名规则为{服务名称}-{命名空间}-{服务名称}
<img src="">
3. 您可基于默认生成的服务，配置路由（Route）。
4. 发起API请求，验证转发到注册中心/容器集群中的服务。

### 删除服务
点击操作-删除，确认是否删除服务服务。确认后将删除服务。
